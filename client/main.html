<!doctype html>
<html lang="en" manifest="cache.manifest">
<head>
    <meta charset="utf-8">
    <title>Welcome to Chess Hub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="lib/jquery/jquery.mobile-1.3.0.min.css"></script>
    <script src="js/chessHubClient-0.1.js"></script>
    <script src="lib/jquery/jquery-1.9.1.js"></script>
    <script src="lib/jquery/jquery.mobile-1.3.0.min.js"></script>
  <script>

    ;CONTEXT = {
		lasterror: {
			code:"",
			message:""
		},
        credentials: {
            user:""
        }
    };

    if ( ! window.console ) console = { log: function(){} };
    
    $(document).ready(function() {
        $("#login_submit").click(function(event) {
                event.preventDefault();
                connect($("#login_username").val());
        });
    });
    
    function connect(user) {
        $.mobile.loading('show');
        CHESSHUB.connect(user,
                function(response) {
                    $('#login_returnmessage').text(response.returnmessage);
                    $.mobile.loading('hide');
                    if(response.returncode == 'ok'){
                        CHESSHUB.poll();
                    }
				},
                function(error) {
                    $.mobile.loading('hide');
                    $('#login_returnmessage').text("Error connecting you to the server :(");
                }
        );
    }
    
  </script>
</head>
<body>

<!--############### Login Page ###############-->
<div data-role="page" id="loginpage"> <!-- identification -->
    <header data-role="header">
		<h1>Login</h1>
	</header>
        <h2>Please enter a username</h2>
        <input type='text' id="login_username" onkeypress="{if (event.keyCode==13 && this.value !== '') connect(this.value)}">
        <span class="info" id="login_returnmessage"></span>
        <button id="login_submit" type="submit" data-theme="a">Submit</button>
</div>


<!--############### Main Page ###############-->
<div data-role="page" id="mainpage">
    <div id="chat_output"></div>
    <div id="chat_input_container">
        <input type='text' id="chat_input" onkeypress="{if (event.keyCode==13) sendMessage(this.value)}">
    </div>
</div>

</body>
</html>
